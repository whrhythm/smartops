# This file is for GKE installation only.
# It is applied by `helm upgrade` after the `values-showcase.yaml` is applied and only contains complementary differences for GKE.
# Note, that it overwrites the whole key that is present in this file.
# The only exception is global.dynamic.plugins, that gets merged with the base file.
route:
  enabled: false
global:
  dynamic:
    plugins:
      # Disable plugins to save disk space on GKE
      # These plugins correspond to tests that are ignored in showcase-k8s project
      # See e2e-tests/playwright.config.ts lines 109-125

      # Tekton - test ignored
      # Test file: e2e-tests/playwright/e2e/plugins/tekton/tekton.spec.ts
      - package: ./dynamic-plugins/dist/backstage-community-plugin-tekton
        disabled: true

      # OCM - test ignored
      # Test file: e2e-tests/playwright/e2e/plugins/ocm.spec.ts (currently doesn't exist)
      - package: ./dynamic-plugins/dist/backstage-community-plugin-ocm-backend-dynamic
        disabled: true
      - package: ./dynamic-plugins/dist/backstage-community-plugin-ocm
        disabled: true

      # Dynamic Home Page - test ignored
      # Test file: e2e-tests/playwright/e2e/dynamic-home-page-customization.spec.ts
      - package: ./dynamic-plugins/dist/red-hat-developer-hub-backstage-plugin-dynamic-home-page
        disabled: true

      # Scorecard - test ignored
      # Test file: e2e-tests/playwright/e2e/plugins/scorecard/scorecard.spec.ts
      - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-scorecard:pr_1499__0.1.0!red-hat-developer-hub-backstage-plugin-scorecard
        disabled: true

      # Adoption Insights - large plugin (~300MB) causing disk space issues
      # This plugin IS tested on showcase-k8s normally, but disabled on GKE to save disk space
      # Test skipped on GKE: e2e-tests/playwright/e2e/plugins/adoption-insights/adoption-insights.spec.ts
      - package: ./dynamic-plugins/dist/red-hat-developer-hub-backstage-plugin-adoption-insights
        disabled: true
      - package: ./dynamic-plugins/dist/red-hat-developer-hub-backstage-plugin-adoption-insights-backend-dynamic
        disabled: true
      - package: ./dynamic-plugins/dist/red-hat-developer-hub-backstage-plugin-analytics-module-adoption-insights-dynamic
        disabled: true

      # Orchestrator - large OCI plugins causing disk space issues
      # Tests skipped on GKE: e2e-tests/playwright/e2e/plugins/orchestrator/*.spec.ts
      - package: "oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-orchestrator:bs_1.45.3__5.3.1!red-hat-developer-hub-backstage-plugin-orchestrator"
        disabled: true
      - package: "oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-orchestrator-backend:bs_1.45.3__8.3.0!red-hat-developer-hub-backstage-plugin-orchestrator-backend"
        disabled: true
      - package: "oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-scaffolder-backend-module-orchestrator:bs_1.45.3__1.3.1!red-hat-developer-hub-backstage-plugin-scaffolder-backend-module-orchestrator"
        disabled: true
      - package: "oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-orchestrator-form-widgets:bs_1.45.3__1.2.0!red-hat-developer-hub-backstage-plugin-orchestrator-form-widgets"
        disabled: true

      # Scaffolder relation processor - keep enabled for K8s
      - package: ./dynamic-plugins/dist/backstage-community-plugin-catalog-backend-module-scaffolder-relation-processor-dynamic
        disabled: false
upstream:
  backstage:
    extraEnvVarsSecrets:
      - rhdh-secrets
    podSecurityContext:
      fsGroup: 2000
    startupProbe:
      failureThreshold: 10 # Override the default to account for longer startup time on Kubernetes.
  postgresql:
    primary:
      podSecurityContext:
        enabled: true
        fsGroup: 3000
  volumePermissions:
    enabled: true
  service:
    type: NodePort
  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: gce
      kubernetes.io/ingress.global-static-ip-name: rhdh-static-ip
      ingress.gcp.kubernetes.io/pre-shared-cert: ""
      networking.gke.io/v1beta1.FrontendConfig: rhdh-gke-ingress-security-config
    className: gce
orchestrator: null
